COLOR_RED	 = \033[0;31m
COLOR_GREEN  = \033[0;32m
COLOR_YELLOW = \033[0;33m
COLOR_BLUE	 = \033[0;34m
COLOR_PURPLE = \033[0;35m
COLOR_CYAN	 = \033[0;36m
COLOR_GREY 	 = \033[0;37m

COLOR_RED_LIGHT	   = \033[1;31m
COLOR_GREEN_LIGHT  = \033[1;32m
COLOR_YELLOW_LIGHT = \033[1;33m
COLOR_BLUE_LIGHT   = \033[1;34m
COLOR_PURPLE_LIGHT = \033[1;35m
COLOR_CYAN_LIGHT   = \033[1;36m
COLOR_GREY_LIGHT   = \033[1;37m

COLOR_END = \033[m

STRING_OK      = $(COLOR_GREEN_LIGHT)[SUCCES]$(COLOR_END)
STRING_WARNING = $(COLOR_YELLOW_LIGHT)[WARNING]$(COLOR_END)
STRING_ERROR   = $(COLOR_RED_LIGHT)[ERROR]$(COLOR_END)


#Compilation
CXX        = g++
CXXFLAGS   = -g -std=c++2a -Wextra -Wall -pedantic


OBJECT_FOLDERS = $(subst $(SOURCE_FOLDER),$(OBJECT_FOLDER),$(shell $(COMMAND_FIND) $(SOURCE_FOLDER) -type d))
OBJECT_FILES   = $(shell $(COMMAND_FIND) $(OBJECT_FOLDER) -name *.o)

#List of all .cpp files to compile
SOURCES     = $(wildcard $(SOURCE_FOLDER)/*.cpp) $(wildcard $(SOURCE_FOLDER)/**/*.cpp) $(wildcard $(SOURCE_FOLDER)/**/**/*.cpp) $(wildcard $(SOURCE_FOLDER)/**/**/**/*.cpp)

#List of targets for the compilation (a .o for each .cpp file)
OBJECTS     = $(SOURCES:$(SOURCE_FOLDER)/%.cpp=$(OBJECT_FOLDER)/%.o)

#Paths

SOURCE_FOLDER  = Sources
INCLUDE_FOLDER = Includes
OBJECT_FOLDER  = Obj
BIN_FOLDER     = Bin


#External libraries
EXTERNAL_LIBRARIES_FOLDER 	  = ../ExternalLibraries

GENERATED_LIBRARIES_TO_INCLUDE =
GENERATED_LIBRARIES_TO_LINK =

#---------------------------------------------#
#All

#Folder where we will create a symbolink link to INCLUDE_FOLDER for other libraries
GULG_LIBRARIES_INCLUDES_FOLDER = ../GulgLibraries/Includes

#Folder where we will create a symbolink link to LIBRARY_FOLDER for other libraries
GULG_LIBRARIES_TO_LINK_FOLDER  = ../GulgLibraries/Libraries

LOWER_LIBRARY_NAME = $(shell echo $(LIBRARY_NAME)| $(COMMAND_TR) A-Z a-z)

#Link
STATIC_LIBRARY_FOLDER  = Static
DYNAMIC_LIBRARY_FOLDER = Dynamic
STATIC_LIBRARY_NAME    = lib$(LOWER_LIBRARY_NAME).a
DYNAMIC_LIBARY_NAME    = lib$(LOWER_LIBRARY_NAME).so


all: compile staticlib exportLib
	@$(COMMAND_PRINTF) "$(COLOR_PURPLE_LIGHT)$(LIBRARY_NAME) successfully made$(COLOR_END)\\n"

compile: $(OBJECTS)
	@$(COMMAND_PRINTF) "$(COLOR_GREEN_LIGHT)Compilation done$(COLOR_END)\\n"

$(OBJECT_FOLDER)/%.o: $(SOURCE_FOLDER)/%.cpp
	@$(COMMAND_MKDIR) -p $(OBJECT_FOLDERS)
	@$(COMMAND_PRINTF) "$(COLOR_GREEN_LIGHT)Compiling:  $(COLOR_END)$(COLOR_CYAN_LIGHT)$<$(COLOR_END)\\n"
	@-$(CXX) $(CXXFLAGS) -DSFML_STATIC -fPIC -c $< -o $@ -I $(INCLUDE_FOLDER) $(GENERATED_LIBRARIES_TO_INCLUDE)
	

staticlib: compile
	@$(COMMAND_MKDIR) -p $(LIBRARY_FOLDER)/$(STATIC_LIBRARY_FOLDER)
	@$(COMMAND_AR) rsc $(LIBRARY_FOLDER)/$(STATIC_LIBRARY_FOLDER)/$(STATIC_LIBRARY_NAME) $(OBJECT_FILES)
	@$(COMMAND_PRINTF) "$(COLOR_GREEN_LIGHT)Static library created$(COLOR_END)\\n"

dynamiclib: compile
	@$(COMMAND_MKDIR) -p $(LIBRARY_FOLDER)/$(DYNAMIC_LIBRARY_FOLDER)
	@-$(CXX) -shared -o $(LIBRARY_FOLDER)/$(DYNAMIC_LIBRARY_FOLDER)/$(DYNAMIC_LIBARY_NAME) $(OBJECT_FILES)
	@$(COMMAND_PRINTF) "$(COLOR_GREEN_LIGHT)Dynamic library created$(COLOR_END)\\n"

exportLib:
	@$(COMMAND_MKDIR) -p $(GULG_LIBRARIES_INCLUDES_FOLDER)
	@$(COMMAND_MKDIR) -p $(GULG_LIBRARIES_TO_LINK_FOLDER)
#OS-DIFFERENCE#
#Windows
	@$(COMMAND_RM) -f $(GULG_LIBRARIES_INCLUDES_FOLDER)/$(LIBRARY_NAME)
	@$(COMMAND_RM) -f $(GULG_LIBRARIES_TO_LINK_FOLDER)/$(LIBRARY_NAME)
	@mklink /D "$(realpath $(GULG_LIBRARIES_INCLUDES_FOLDER)/$(LIBRARY_NAME))" "$(realpath $(INCLUDE_FOLDER)/$(LIBRARY_NAME))"
	@mklink /D "$(realpath $(GULG_LIBRARIES_TO_LINK_FOLDER)/$(LIBRARY_NAME))" "$(realpath $(LIBRARY_FOLDER))"
#Linux
	ln -sf "$(realpath $(INCLUDE_FOLDER)/$(LIBRARY_NAME))" $(GULG_LIBRARIES_INCLUDES_FOLDER)
	ln -sf "$(realpath $(LIBRARY_FOLDER))" $(GULG_LIBRARIES_TO_LINK_FOLDER)
#OS-DIFFERENCE-END#

	@$(COMMAND_PRINTF) "$(COLOR_GREEN_LIGHT)Library successfully exported$(COLOR_END)\\n"

clean:
	@$(COMMAND_RM) -rf $(GULG_LIBRARIES_INCLUDES_FOLDER)/$(LIBRARY_NAME)
	@$(COMMAND_RM) -rf $(GULG_LIBRARIES_TO_LINK_FOLDER)/$(LIBRARY_NAME)
	@$(COMMAND_RM) -rf $(OBJECT_FOLDER)
	@$(COMMAND_RM) -rf $(LIBRARY_FOLDER)
	@$(COMMAND_RM) -rf $(BIN_FOLDER)

#---------------------------------------------#
#lib

all: $(OBJECTS)
	@$(COMMAND_PRINTF) "$(COLOR_GREEN_LIGHT)Compilation done$(COLOR_END)\\n"
	@$(COMMAND_PRINTF) "$(COLOR_GREEN_LIGHT)Linking $(COLOR_END)$(COLOR_YELLOW_LIGHT)$(OBJECTS)$(COLOR_END)\\n"
	@$(COMMAND_MKDIR) -p $(EXE_FOLDER)
	@$(CXX) $(OBJECTS) -o $(EXE_FOLDER)/$(EXE_NAME) $(GENERATED_LIBRARIES_TO_LINK)
	@$(COMMAND_PRINTF) "$(COLOR_GREEN_LIGHT)Linking done$(COLOR_END)\\n"
	@$(COMMAND_PRINTF) "$(COLOR_GREEN_LIGHT)Executable created at path: $(COLOR_END)$(COLOR_RED_LIGHT)$(EXE_FOLDER)/$(EXE_NAME)$(COLOR_END)\\n"
	@$(COMMAND_CP) $(EXE_FOLDER)/$(EXE_NAME) ../

copyExeToParent:
	@$(COMMAND_CP) $(EXE_FOLDER)/$(EXE_NAME) ../

$(OBJECT_FOLDER)/%.o: $(SOURCE_FOLDER)/%.cpp
	@$(COMMAND_MKDIR) -p $(OBJECT_FOLDERS)
	@$(COMMAND_PRINTF) "$(COLOR_GREEN_LIGHT)Compiling:  $(COLOR_END)$(COLOR_CYAN_LIGHT)$<$(COLOR_END)\\n"
	@-$(CXX) $(CXXFLAGS) -fPIC -c $< -o $@ -I $(INCLUDE_FOLDER) $(GENERATED_LIBRARIES_TO_INCLUDE)

clean:
	@$(COMMAND_RM) -rf $(OBJECT_FOLDER)
	@$(COMMAND_RM) -rf $(EXE_FOLDER)
	@$(COMMAND_RM) -rf $(BIN_FOLDER)


#---------------------------------------------#
#exe